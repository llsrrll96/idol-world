<!DOCTYPE html>
<html lang="en">
<head>
    <title>Home</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}">

    <!-- jQuery ì¶”ê°€ -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="wrapper">
        <div class="wrapper__header">
            <div class="contents__title">
                <div class="title">Updated news</div>
            </div>
            <div class="divideLine"></div>
            <div class="contents__body">
                <ul>
                    <li>ì‹¸ì´ì›”ë“œ ì›¹ ë²„ì „ì´ ì‚¬ë¼ì§„ê²Œ ì•„ì‰¬ì›Œì„œ ì§ì ‘ ë§Œë“  ë¯¸ë‹ˆí™ˆí”¼ì…ë‹ˆë‹¤ ğŸ </li>
                    <li>ê²Œì„ íƒ­ì— ë“¤ì–´ê°€ì„œ 3ê°€ì§€ ë¯¸ë‹ˆê²Œì„ì„ í•´ë³´ì„¸ìš”!</li>
                    <li>ê²Œì„ íƒ­ì— ë“¤ì–´ê°€ì„œ 3ê°€ì§€ ë¯¸ë‹ˆê²Œì„ì„ í•´ë³´ì„¸ìš”!</li>
                    <li>ê²Œì„ íƒ­ì— ë“¤ì–´ê°€ì„œ 3ê°€ì§€ ë¯¸ë‹ˆê²Œì„ì„ í•´ë³´ì„¸ìš”!</li>
                </ul>
            </div>
        </div>
        <div class="wrapper__body">
            <div class="contents__title">
                <div class="miniroom_title">Mini Room</div>
                <div class="subtitle">ì‚¬ë‘í•˜ëŠ” ì›¨ì´ì˜ ìƒì¼ì„ ì¶•í•˜í•©ë‹ˆë‹¤ğŸ‰</div>
            </div>
            <div class="divideLine"></div>
            <div class="mini-room-image">
                <img src="/static/images/hgf.jpg" alt="Mini Room" />
            </div>
            <div class="comments-section">
                <div>
                    <p class="comments-title">What Way's fan say  <span class="comments-subtitle">í•œë§ˆë””ë¡œ í‘œí˜„í•´ë´~ </span></p>
                </div>
                <div class="comments-body">
                    <form id="commentForm">
                        <div class="comment-input">
                            <div class="comment-input">
                                <input type="text" id="commentInput" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..." required />
                            </div>
                            <div class="nickname-password-input">
                                <input type="text" id="nicknameInput" placeholder="ë‹‰ë„¤ì„" required />
                                <input type="password" id="passwordInput" placeholder="ë¹„ë°€ë²ˆí˜¸" required />
                                <button type="submit" id="submitButton">í™•ì¸</button>
                            </div>
                        </div>
                    </form>
                    <ul id="comments" class="comment-list">
                        {% for comment in comments %}
                            <li class="comment-item">
                                <p>
                                    {% if user_role != 'admin' %}
                                        ì›¨ì´ ìƒíƒ„ì¼(24.12.28) ê³µê°œ
                                    {% else %}
                                        {{ comment.content }}
                                    {% endif %}
                                    (<span class="comment-nickname">{{ comment.username }}</span>)
                                </p>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</body>

<script>
    $(document).ready(function() {
        $('#commentForm').on('submit', function(event) {
            event.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë°©ì§€

            const comment = $('#commentInput').val();
            const nickname = $('#nicknameInput').val();
            const password = $('#passwordInput').val();

            if (password.length < 4) {
                alert('ë¹„ë°€ë²ˆí˜¸ëŠ” 4ìë¦¬ ì´ìƒìœ¼ë¡œ í•´ì£¼ì„¸ìš”.')
                return; // ë¹„ë°€ë²ˆí˜¸ê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ì œì¶œí•˜ì§€ ì•ŠìŒ
            }

            const body = {
                comment: comment,
                nickname: nickname,
                password: password
            }

            const submitButton = $('#submitButton');
            submitButton.prop('disabled', true)

            // POST ìš”ì²­ì„ ìœ„í•œ jQuery AJAX
            $.ajax({
                url: '/comment/submit-comment',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(body),
                success: function(data) {
                    console.log('success:', data);
                    //  if ì„±ê³µì‹œ
                    if (data.status === "success") {
                        const htmltext = '<li class="comment-item"><p>' + data.comment + ' (' + '<span class="comment-nickname">' + data.nickname + '</span>' + ')</p></li>';

                        $('#comments').append(htmltext);
                        $('#commentInput').val('');
                        $('#nicknameInput').val('');
                        $('#passwordInput').val('');
                    }
                    // ì¼ì • ì‹œê°„ í›„ ë²„íŠ¼ í™œì„±í™”
                    setTimeout(function() {
                        submitButton.prop('disabled', false); // ë²„íŠ¼ í™œì„±í™”
                    }, 2000); // 2ì´ˆ í›„ì— í™œì„±í™”
                },
                error: function(error) {
                    console.error('Error:', error);
                    submitButton.prop('disabled', false);
                }
            });
        });
    });
</script>

</html>
